import{p as t,a as e,r as s,o as a,c as r,b as n,w as i,d as o,F as l,t as d,e as c,f as u,g as p,h,i as m,j as g,v,k as P,K as _,X as f}from"./vendor.63163dcb.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const a=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,n)=>{const i=new URL(t,a);if(self[e].moduleMap[i])return s(self[e].moduleMap[i]);const o=new Blob([`import * as m from '${i}';`,`${e}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){n(new Error(`Failed to import: ${t}`)),r(l)},onload(){s(self[e].moduleMap[i]),r(l)}});document.head.appendChild(l)})),self[e].moduleMap={}}}("/lego-set-checker/assets/");var b={name:"Header",props:{contentSelector:String},data:()=>({searchedSet:"",sets:[]}),methods:{async onSearch(t){const e=await this.$http.get("https://rebrickable.com/api/v3/lego/sets",{params:{search:t},headers:{Authorization:"key 2d917e228bae2a71075a8de5361b4f49"}});this.sets=e.data.results.map((t=>({label:`${t.set_num} | ${t.name}`,key:t.set_num})))},onSelect(t){this.searchedSet=t.label,this.$emit("setSelected",t.key)}},emits:["setSelected"]};const y=i("data-v-35c2ccd2");t("data-v-35c2ccd2");const $={class:"searchbar__icon"},S=o("search");e();const w=y(((t,e,i,o,l,d)=>{const c=s("ui-icon"),u=s("ui-autocomplete"),p=s("ui-top-app-bar");return a(),r(p,{"nav-icon":!1,"content-selector":i.contentSelector,title:"Lego Set Checker"},{toolbar:y((()=>[n(u,{"model-value":l.searchedSet,source:l.sets,class:"autocomplete",delay:"500",placeholder:"Search set by ID",remote:"",onSearch:d.onSearch,onSelected:d.onSelect},{after:y((()=>[n("div",$,[n(c,{dark:"",outlined:""},{default:y((()=>[S])),_:1})])])),_:1},8,["model-value","source","onSearch","onSelected"])])),_:1},8,["content-selector"])}));b.render=w,b.__scopeId="data-v-35c2ccd2";const x=t=>{const e=localStorage.getItem(t);return e?JSON.parse(e):void 0};var k={name:"SetCard",computed:{set(){return this.$store.state.set},missingParts(){return this.$store.state.missingParts},uniqueMissingParts(){return this.$store.state.uniqueMissingParts}},data:()=>({missingOnly:!1}),methods:{async fetchParts(){this.$emit("fetchParts",this.set.set_num)},handleExport(){let t=x(this.set.set_num);if(null==t?void 0:t.parts){let e="sep=,\r\n\n";["id","name","quantity","quantity_owned","url"].forEach((t=>e+=`${t},`)),e=`${e.slice(0,-1)}\r\n`,t.parts.map((t=>({id:t.id,name:t.part.name,quantity:t.quantity,quantity_owned:t.quantity_owned,url:t.part.part_url}))).filter((t=>!this.missingOnly||t.quantity>(t.quantity_owned||0))).forEach((t=>{let s="";Object.values(t).forEach((t=>s+=`"${t||0}",`)),e+=`${s}\r\n`})),l.saveAs(new File([e],`${this.set.set_num} - ${this.set.name}.csv`,{type:"text/csv"}))}}},emits:["fetchParts"]};const C=i("data-v-423c7723");t("data-v-423c7723");const q={key:0,class:"set-card__container"},M={class:"set-card__info"},N={class:"set-card__info-text"},E=n("div",{class:"set-card__info-labels"},[n("div",null,"Name:"),n("div",null,"Set-Number:"),n("div",null,"Parts:")],-1),O={class:"set-card__info-values"},I=o("Get parts"),L={class:"set-card__missing-parts"},R={class:"set-card__info-text"},U=n("div",{class:"set-card__info-labels"},[n("div",null,"Total:"),n("div",null,"Missing:"),n("div",null,"Unique missing:")],-1),j={class:"set-card__info-values right-align"},F={class:"set-card__checkbox-container"},V=n("label",{for:"checkbox"},"Missing Only",-1),z=o("Export");e();const A=C(((t,e,i,o,l,u)=>{const p=s("ui-button"),h=s("ui-checkbox");return u.set?(a(),r("div",q,[n("div",null,[n("img",{src:u.set.set_img_url,alt:"",class:"set-card__image",width:"200"},null,8,["src"])]),n("div",M,[n("div",N,[E,n("div",O,[n("div",null,d(u.set.name),1),n("div",null,d(u.set.set_num),1),n("div",null,d(u.set.num_parts),1)])]),n(p,{raised:"",onClick:u.fetchParts},{default:C((()=>[I])),_:1},8,["onClick"])]),n("div",L,[n("div",R,[U,n("div",j,[n("div",null,d(u.set.num_parts),1),n("div",null,d(u.missingParts),1),n("div",null,d(u.uniqueMissingParts),1)])]),n("div",F,[n(h,{modelValue:l.missingOnly,"onUpdate:modelValue":e[1]||(e[1]=t=>l.missingOnly=t),"input-id":"checkbox"},null,8,["modelValue"]),V]),n(p,{raised:"",onClick:u.handleExport},{default:C((()=>[z])),_:1},8,["onClick"])])])):c("",!0)}));k.render=A,k.__scopeId="data-v-423c7723";var J={name:"PartCard",props:{part:null},methods:{handlePersistPart(){((t,e)=>{var s;const a=x(t);if(!a)throw new Error(`set with id ${t} was not found in local storage`);a.parts=null==(s=a.parts)?void 0:s.map((t=>t.id===e.id?e:t)),localStorage.setItem(t,JSON.stringify(a))})(this.part.set_num,this.part),this.$store.dispatch("setMissingParts")},handleEnter(){this.$emit("enterPressed")}},emits:["enterPressed"]};const G=i("data-v-0f65b0a3");t("data-v-0f65b0a3");const H={key:0,class:"part-card__container"},K={class:"part-card__info"},T=n("div",{class:"part-card__info-labels"},[n("div",null,"Name:"),n("div",null,"Quantity:")],-1),Q={class:"part-card__info-values"},B={class:"part-card__form"},D=n("hr",null,null,-1);e();const X=G(((t,e,i,o,l,h)=>{const m=s("ui-textfield");return a(),r(p,null,[i.part?(a(),r("div",H,[n("img",{src:i.part.part.part_img_url,alt:"",class:"part-card__image",width:"100"},null,8,["src"]),n("div",K,[T,n("div",Q,[n("div",null,d(i.part.part.name),1),n("div",null,d(i.part.quantity),1)])]),n("div",B,[n(m,{modelValue:i.part.quantity_owned,"onUpdate:modelValue":e[1]||(e[1]=t=>i.part.quantity_owned=t),modelModifiers:{number:!0},"input-type":"number",placeholder:"Quantity owned",onChange:h.handlePersistPart,onKeypress:u(h.handleEnter,["enter"])},null,8,["modelValue","onChange","onKeypress"])])])):c("",!0),D],64)}));J.render=X,J.__scopeId="data-v-0f65b0a3";const W=t=>parseInt(t.slice(t.indexOf("page=")+5,t.lastIndexOf("&")));var Y={name:"PartsList",components:{PartCard:J},props:{loading:!1,partsCount:null},computed:{set(){return this.$store.state.set},parts(){return this.$store.state.parts},nextPage(){return this.$store.state.nextPage},prevPage(){return this.$store.state.prevPage}},methods:{handlePrev(){this.$emit("getPartsPage",this.prevPage)},handleNext(){this.$emit("getPartsPage",this.nextPage)},getCurrentPageNumber(){return this.nextPage?W(this.nextPage)-1:this.prevPage?W(this.prevPage)+1:void 0},getTotalPages(){return Math.ceil(this.partsCount/5)},updateMissingParts(){this.$emit("updateMissingParts")},handleNextPart(t){const e=this.$refs[t];e?e.$el.nextSibling.childNodes[2].childNodes[0].childNodes[6].focus():this.handleNext()}},emits:["getPartsPage","updateMissingParts"]};const Z=i("data-v-1b59496d");t("data-v-1b59496d");const tt={key:0,class:"parts-container"},et={key:0,class:"parts-list"},st={key:1,class:"parts-list"},at={class:"page-buttons"},rt=o("prev"),nt=o("next");e();const it=Z(((t,e,i,o,l,u)=>{const m=s("ui-spinner"),g=s("PartCard"),v=s("ui-button");return u.parts&&u.set?(a(),r("div",tt,[i.loading?(a(),r("div",et,[n(m,{active:""})])):(a(),r("div",st,[(a(!0),r(p,null,h(u.parts,((t,e)=>(a(),r(g,{ref:`part${e}`,part:t,onEnterPressed:t=>u.handleNextPart(`part${e+1}`)},null,8,["part","onEnterPressed"])))),256))])),n("div",at,[n(v,{disabled:!u.prevPage,raised:"",onClick:u.handlePrev},{default:Z((()=>[rt])),_:1},8,["disabled","onClick"]),n("div",null,d(u.getCurrentPageNumber()||0)+" / "+d(u.getTotalPages()||0),1),n(v,{disabled:!u.nextPage,raised:"",onClick:u.handleNext},{default:Z((()=>[nt])),_:1},8,["disabled","onClick"])])])):c("",!0)}));Y.render=it,Y.__scopeId="data-v-1b59496d";var ot={name:"app",components:{PartsList:Y,PartCard:J,SetCard:k,Header:b},data:()=>({loading:!1,partsCount:0}),computed:{set(){return this.$store.state.set}},methods:{async onSelect(t){const e=x();if(e)await this.$store.dispatch("setSet",e);else{const e=await this.$http.get(`https://rebrickable.com/api/v3/lego/sets/${t}`,{headers:{Authorization:"key 2d917e228bae2a71075a8de5361b4f49"}});await this.$store.dispatch("setSet",e.data),localStorage.getItem(this.set.set_num)||localStorage.setItem(this.set.set_num,JSON.stringify(this.set))}},async getParts(){await this.$store.dispatch("setParts",[]),this.loading=!0;const t=await this.$http.get(`https://rebrickable.com/api/v3/lego/sets/${this.set.set_num}/parts`,{headers:{Authorization:"key 2d917e228bae2a71075a8de5361b4f49"},params:{page_size:5}});this.handleResponseParts(t)},async getPartsPage(t){await this.$store.dispatch("setParts",[]),this.loading=!0;const e=await this.$http.get(t,{headers:{Authorization:"key 2d917e228bae2a71075a8de5361b4f49"}});this.handleResponseParts(e)},handleResponseParts(t){t.data.results.forEach((t=>{const e=((t,e)=>{var s;const a=x(t);return a?null==(s=a.parts)?void 0:s.find((t=>t.id===e.id)):void 0})(this.set.set_num,t);e?this.$store.dispatch("pushPart",e):this.$store.dispatch("pushPart",t)})),this.loading=!1,this.partsCount=t.data.count,this.$store.dispatch("setNextPage",t.data.next),this.$store.dispatch("setPrevPage",t.data.previous),this.$store.dispatch("setMissingParts"),((t,e)=>{const s=x(t);if(!s)throw new Error(`set with id ${t} was not found in local storage`);e.forEach((t=>{var e,a,r;s.parts||(s.parts=[]),(null==(a=null==(e=s.parts)?void 0:e.map((t=>t.id)))?void 0:a.includes(t.id))||null==(r=s.parts)||r.push(t)})),localStorage.setItem(t,JSON.stringify(s))})(this.set.set_num,this.$store.state.parts)}}};const lt={id:"root"},dt=n("hr",{style:{margin:"0"}},null,-1);ot.render=function(t,e,i,o,l,d){const c=s("Header"),u=s("SetCard"),h=s("PartsList");return a(),r(p,null,[n(c,{"content-selector":"#root",onSetSelected:d.onSelect},null,8,["onSetSelected"]),n("div",lt,[n(u,{onFetchParts:d.getParts},null,8,["onFetchParts"]),dt,n(h,{loading:l.loading,"parts-count":l.partsCount,onGetPartsPage:d.getPartsPage},null,8,["loading","parts-count","onGetPartsPage"])])],64)};const ct=Symbol(),ut=m({state:()=>({set:void 0,parts:[],prevPage:"",nextPage:"",missingParts:0,uniqueMissingParts:0}),mutations:{setSet(t,e){t.set=e},setParts(t,e){t.parts=e},pushPart(t,e){var s;null==(s=t.parts)||s.push(e)},setPrevPage(t,e){t.prevPage=e},setNextPage(t,e){t.nextPage=e},setMissingParts(t){if(t.set){const e=(t=>{var e;const s=x(t);if(!s)return;let a=0;return null==(e=s.parts)||e.forEach((t=>{t.quantity_owned&&(a+=t.quantity_owned)})),s.num_parts-a})(t.set.set_num);e&&(t.missingParts=e);const s=(t=>{var e;const s=x(t);if(!s)return;let a=0;return null==(e=s.parts)||e.forEach((t=>{t.quantity_owned?t.quantity_owned<t.quantity&&a++:a++})),a})(t.set.set_num);s&&(t.uniqueMissingParts=s)}}},actions:{setSet(t,e){t.commit("setSet",e)},setParts(t,e){t.commit("setParts",e)},pushPart(t,e){t.commit("pushPart",e)},setPrevPage(t,e){t.commit("setPrevPage",e)},setNextPage(t,e){t.commit("setNextPage",e)},setMissingParts(t){t.commit("setMissingParts")}}}),pt=g(ot);pt.use(v,P),pt.use(_),pt.use(f),pt.use(ut,ct),pt.mount("#app");
